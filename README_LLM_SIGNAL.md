# KIS LLM 신호 알림 시스템

14b × 2 병렬 LLM으로 추세를 분석하고 텔레그램으로 매매 신호를 알려주는 시스템입니다.

## 주요 기능

✅ **14b × 2 병렬 LLM 분석**
- qwen2.5:14b 모델 2개를 병렬 실행
- 앙상블 방식으로 신뢰도 높은 신호 생성

✅ **텔레그램 신호 알림**
- BULL (상승) → SOXL 매수 권장
- BEAR (하락) → SOXS 매수 권장
- 신뢰도 60% 이상일 때만 알림
- 포지션 전환 권장도 알림

✅ **포지션 변경 감지**
- 계좌 포지션이 바뀌면 즉시 알림
- 사용자가 직접 거래한 것을 확인

❌ **자동 주문 없음**
- KIS API로 자동 매수/매도 하지 않음
- 알림만 받고 사용자가 직접 거래

## 필요한 프로그램

1. **Python 3.11** (이미 설치됨)
2. **Ollama** (이미 설치됨)
3. **qwen2.5:14b 모델** (이미 다운로드됨)

## 필요한 라이브러리

```bash
pip install pyyaml requests psutil
```

## 실행 방법

### 1단계: 프로그램 실행 (하나만!)

```bash
python kis_llm_signal_notifier.py
```

**끝!** 이게 전부입니다. 프로그램이 자동으로:
1. Ollama 11435 포트로 시작
2. 텔레그램 연결 테스트
3. 현재 포지션 확인 및 알림
4. 5분마다 LLM 분석 시작

### 2단계: 텔레그램 확인

휴대폰으로 텔레그램 앱을 열고 알림을 기다립니다.

### 3단계: 알림 받으면 직접 거래

신호가 오면 한국투자증권 앱/웹에서 직접 매수/매도하세요.

## 텔레그램 알림 예시

### 시작 알림
```
🚀 KIS LLM 신호 알림 시작

⏰ 시작 시간: 2025-10-08 15:00:00

🤖 분석 모델: 14b × 2 병렬 LLM
📊 전략: 추세돌파 감지

💼 현재 포지션: 없음
💰 USD 현금: $1,234.56

🔔 매매 신호 알림을 시작합니다.
```

### 매수 신호
```
🟢 LLM 분석 신호

⏰ 시간: 2025-10-08 15:30:00

🤖 14b×2 LLM 판단:
  - 신호: 매수 신호
  - 종목: SOXL
  - 신뢰도: 75%

💡 분석 근거:
상승 모멘텀 강화, 반도체 섹터 강세

📊 현재 포지션: 없음
```

### 포지션 전환 권장
```
🔴 LLM 분석 신호

⏰ 시간: 2025-10-08 16:00:00

🤖 14b×2 LLM 판단:
  - 신호: 매도/공매도 신호
  - 종목: SOXS
  - 신뢰도: 82%

💡 분석 근거:
상승 모멘텀 약화, 반전 징후 감지

⚠️ 포지션 전환 권장
현재: SOXL (손익 +5.80%)
추천: SOXS

📊 현재 포지션: SOXL
```

### 포지션 변경 감지
```
🔄 포지션 변경 감지!

⏰ 시간: 2025-10-08 16:05:00

📊 변경 내용:
  - 이전: SOXL
  - 현재: SOXS

💰 USD 현금: $800.00

✅ 거래가 실행되었습니다.
```

## 분석 주기

- **기본**: 5분마다 (300초)
- **변경 방법**: `kis_llm_signal_notifier.py` 파일 마지막 줄 수정
  ```python
  notifier.run(interval_seconds=300)  # 5분
  notifier.run(interval_seconds=180)  # 3분으로 변경
  notifier.run(interval_seconds=600)  # 10분으로 변경
  ```

## 주의사항

### 1. LLM 분석 시간
- 14b 모델 2개를 병렬 실행하므로 1-2분 소요
- 분석 중에는 "LLM 분석 시작..." 메시지 표시
- 너무 짧은 간격(1분 이하)은 권장하지 않음

### 2. Ollama 메모리
- 14b 모델은 약 8-10GB RAM 사용
- 컴퓨터에 최소 16GB RAM 권장

### 3. 신호의 의미
- **BULL → SOXL**: 반도체 섹터 상승 예상
- **BEAR → SOXS**: 반도체 섹터 하락 예상
- **신뢰도**: LLM 2개의 의견 일치도
  - 60-70%: 약한 신호
  - 70-80%: 보통 신호
  - 80% 이상: 강한 신호

### 4. 실제 거래는 본인 판단
- LLM 신호는 참고용입니다
- 최종 거래 결정은 본인이 하세요
- 손실에 대한 책임은 본인에게 있습니다

## 프로그램 종료

터미널에서 `Ctrl+C` 키를 누르면 종료됩니다.

## 문제 해결

### Ollama 시작 실패
```
❌ Ollama 시작 실패: ...
```
- 수동으로 `start_ollama_11435.bat` 실행
- 또는 Ollama가 이미 실행 중일 수 있음 (무시 가능)

### LLM 응답 없음
```
[LLM 1] 오류: HTTP 404
```
- qwen2.5:14b 모델이 없는 경우
- 터미널에서 실행:
  ```bash
  ollama pull qwen2.5:14b
  ```

### 텔레그램 연결 실패
- `telegram_config.json` 파일의 `bot_token`과 `chat_id` 확인
- 봇이 활성화되어 있는지 확인

### API 오류
- `kis_devlp.yaml` 파일의 API 키 확인
- `kis_token.json` 파일 확인 (만료 시 재생성 필요)

## 파일 구성

- `kis_llm_signal_notifier.py` - 메인 프로그램 (이것만 실행!)
- `telegram_config.json` - 텔레그램 설정
- `kis_devlp.yaml` - KIS API 설정
- `kis_token.json` - API 토큰

## 기술 사양

- **LLM 모델**: qwen2.5:14b × 2 (병렬)
- **분석 방식**: 앙상블 (2개 모델 결과 통합)
- **Ollama 포트**: 11435
- **분석 간격**: 5분 (조정 가능)
- **알림**: 텔레그램

## 라이센스

개인 사용 목적으로만 제공됩니다.
