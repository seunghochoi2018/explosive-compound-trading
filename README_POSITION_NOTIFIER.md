# KIS 포지션 알림 시스템

한국투자증권 계좌의 포지션을 모니터링하고 변경 시 텔레그램으로 알림을 보내는 시스템입니다.

## 주요 기능

1. **시작 시 최초 포지션 알림**
   - 프로그램 시작 시 현재 보유 포지션과 USD 현금 잔고를 텔레그램으로 알림

2. **포지션 변경 감지 및 알림**
   - 30초마다 포지션을 체크하여 변경 사항 감지
   - 포지션이 변경되면 즉시 텔레그램 알림

3. **오류 알림**
   - API 오류나 시스템 오류 발생 시 텔레그램으로 알림

## 파일 구성

- `kis_position_notifier.py` - 메인 프로그램 (포지션 모니터링 및 알림)
- `telegram_config.json` - 텔레그램 설정 파일
- `kis_devlp.yaml` - 한국투자증권 API 설정
- `kis_token.json` - API 액세스 토큰

## 사용 방법

### 1. 필요한 라이브러리 설치

```bash
pip install pyyaml requests
```

### 2. 설정 파일 준비

#### kis_devlp.yaml
한국투자증권 API 키와 계좌 정보가 포함된 설정 파일 (이미 존재)

#### kis_token.json
API 액세스 토큰 (이미 존재하거나 `refresh_kis_token.py` 실행하여 생성)

#### telegram_config.json (선택)
텔레그램 봇 토큰과 채팅 ID를 변경하려면 이 파일을 수정하세요.

```json
{
    "bot_token": "YOUR_BOT_TOKEN",
    "chat_id": "YOUR_CHAT_ID"
}
```

### 3. 프로그램 실행

```bash
python kis_position_notifier.py
```

## 프로그램 작동 방식

1. **초기화**
   - 텔레그램 연결 테스트
   - KIS API 설정 로드
   - 현재 포지션 조회 및 알림

2. **모니터링 루프** (30초 간격)
   - USD 현금 잔고 조회
   - 보유 포지션 조회
   - 이전 포지션과 비교하여 변경 감지
   - 변경 시 텔레그램 알림 전송

3. **종료**
   - `Ctrl+C` 키를 눌러 프로그램 종료

## 텔레그램 알림 예시

### 시작 시 알림
```
🚀 KIS 포지션 알림 시작

⏰ 시작 시간: 2025-10-08 14:30:00

💼 현재 포지션:
  1. SOXL
     - 수량: 10주
     - 평균가: $38.50
     - 현재가: $39.20
     - 손익: +1.82%

💰 USD 현금: $1,234.56

🤖 모니터링 중
```

### 포지션 변경 알림
```
🔄 포지션 변경 감지

⏰ 시간: 2025-10-08 15:00:00

📊 변경 내용:
  - 이전: SOXL 10주
  - 현재: 없음

💼 상세 정보:
  포지션 없음

💰 USD 현금: $1,630.00

🤖 계속 모니터링 중
```

## 주의사항

1. **API 사용 한도**
   - 한국투자증권 API는 초당 요청 횟수 제한이 있습니다
   - 기본 체크 간격은 30초로 설정되어 있습니다

2. **실시간성**
   - 30초마다 체크하므로 실시간이 아닙니다
   - 더 빠른 모니터링이 필요하면 `interval_seconds`를 조정하세요

3. **네트워크 연결**
   - 안정적인 인터넷 연결이 필요합니다
   - 네트워크 오류 시 자동으로 재시도합니다

4. **텔레그램 연결**
   - 텔레그램 봇이 정상 작동해야 알림을 받을 수 있습니다
   - 연결 실패 시에도 프로그램은 계속 실행됩니다

## 설정 변경

### 체크 간격 변경

`kis_position_notifier.py` 파일의 마지막 부분:

```python
# 30초마다 체크 (기본값)
monitor.run(interval_seconds=30)

# 60초마다 체크로 변경
monitor.run(interval_seconds=60)
```

### 텔레그램 비활성화

```python
# 텔레그램 알림 없이 실행
monitor = KISPositionMonitor(enable_telegram=False)
```

## 문제 해결

### 텔레그램 연결 실패
- `telegram_config.json` 파일의 `bot_token`과 `chat_id` 확인
- 텔레그램 봇이 활성화되어 있는지 확인

### API 오류
- `kis_devlp.yaml` 파일의 API 키 확인
- `kis_token.json` 파일이 최신인지 확인 (필요시 `refresh_kis_token.py` 실행)

### 포지션 조회 실패
- 계좌번호가 정확한지 확인
- API 사용 권한이 있는지 확인

## 라이센스

이 프로그램은 개인 사용 목적으로 제공됩니다.
